<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html;" />
    <title>舞管家</title>
	<link rel="stylesheet" type="text/css" href="/static/lib/jquery-easyui-1.5.2/themes/default/easyui.css">
    <link rel="stylesheet" type="text/css" href="/static/lib/jquery-easyui-1.5.2/themes/icon.css">
    <link rel="stylesheet" type="text/css" href="/static/lib/jquery-easyui-1.5.2/themes/color.css">
    <link rel="stylesheet" type="text/css" href="/static/css/IconExtension.css">
    <link rel="stylesheet" type="text/css" href="/static/css/dancemgr.css">
    <script type="text/javascript" src="/static/lib/jquery-easyui-1.5.2/jquery.min.js"></script>
    <script type="text/javascript" src="/static/lib/jquery-easyui-1.5.2/jquery.easyui.min.js"></script>
	<script type="text/javascript" src="/static/lib/jquery-easyui-1.5.2/locale/easyui-lang-zh_CN.js"></script>
    <script type="text/javascript" src="/static/js/dance.tools.js"></script>
    <script type="text/javascript" src="/static/js/jquery.fullcalendar.js"></script>

    <link rel="shortcut icon" href="/static/img/favicon.ico" />
    <link rel="bookmark" href="/static/img/favicon.ico" type="image/x-icon" />
</head>
<body class="easyui-layout">
	<div data-options="region:'north',border:false" style="height:60px;background:url(static/img/top.jpg); padding:10px;">
        <div align="right">
            {{ g.user.name }}
            <a id="btnLogout" href="/logout" class="easyui-linkbutton" data-options="iconCls:'icon-search'">退出</a>
        </div>
    </div>

	<div data-options="region:'west',split:true,hideCollapsedContent:false,title:'功能栏'" style="width:200px;">
        <div class="easyui-accordion" data-options="fit:true,border:false">
            <div title="学员管理" data-options="iconCls:'icon-student',selected:true" style="padding:1px">
                <ul id="treeStudent"></ul>
            </div>
            <div title="员工与老师" data-options="iconCls:'icon-teacher'" style="padding:1px">
                <ul id="treeTeacher"></ul>
            </div>
            <div title="教学管理" data-options="iconCls:'icon-book'" style="padding:1px">
                <ul id="treeSchool"></ul>
            </div>
            <div title="物品管理" data-options="iconCls:'icon-computer'" style="padding:1px">
                <ul id="treeAsset"></ul>
            </div>
            <div title="财务管理" data-options="iconCls:'icon-money_yen'" style="padding:1px">
                <ul id="treeFinance"></ul>
            </div>
            <div title="数据管理" data-options="iconCls:'icon-databases'" style="padding:1px">
                <ul id="treeDb"></ul>
            </div>
        </div>
	</div>
	<div data-options="region:'south',border:false" style="height:40px;background:url(/static/img/bottom.gif);padding:10px;">
        <div align="center">
            版权所有：华盛星辉©2015-2017
        </div>
    </div>

	<div data-options="region:'center'">
        <div class="easyui-tabs" data-options="fit:true,border:false,plain:false" id="danceTabs">
            <div title="主页">
                <div style="background:url(/static/img/hill-water.jpg) no-repeat fixed center; width: 100%; height: 100%"></div>
            </div>
        </div>
    </div>


<script>
'use strict';

$(function() {
    $('#treeStudent').tree({
        animate:true,lines:true,
        onClick: function(node){
            var root = getRootNode(this, node);
            var tableRootId = this.id + root.id;

            if (root.id == 10) {   // 学员列表
                danceAddTabStudentDatagrid('danceTabs', root.text, tableRootId, node.attributes);
            } else if (root.id == 60) {   // 班级学员统计
                danceAddTabClassStudentStat(root.text, node.attributes);
            } else if (root.id == 30) {    // '收费单（学费）'
                danceAddTabFeeStudyDatagrid('danceTabs', root.text, tableRootId, node.attributes);
            } else if (root.id == 40) {    // 收费单（演出）
                danceAddTabFeeShowDatagrid('danceTabs', root.text, tableRootId, node.attributes);
            } else if (root.id == 50) {    // 收费单（普通）
                danceAddTabFeeOtherDatagrid('danceTabs', root.text, tableRootId, node.attributes);
            } else {
                $.messager.alert('提示', ' 制作中...', 'info');
            }
        }
    });

    $('#treeTeacher').tree({
        animate:true,lines:true,
        onClick: function(node){
            var root = getRootNode(this, node);
            var tableRootId = this.id + root.id;
            console.log(root.text, ' tableRootId=', tableRootId);

            if(root.id == 10){
                danceAddTabTeacher(root.text, tableRootId, node.attributes);
            }else{
                $.messager.alert('提示', ' 制作中...', 'info');
            }
        }
    });

    $('#treeSchool').tree({
        animate:true,lines:true,
        onClick:function (node) {
            var root = getRootNode(this, node);
            var tableRootId = this.id + root.id;
            var entrance = {
                10: {fn: danceAddTabClassDatagrid},     // 班级信息
                20: {fn: danceAddTabCourse}
            };

            if(root.id in entrance){
                entrance[root.id].fn(root.text, tableRootId, node.attributes);
            } else {
                $.messager.alert('提示', ' 制作中...', 'info');
            }
        }
    });

    $('#treeAsset').tree({
        animate:true,lines:true,
        onClick: function(node){
            var root = getRootNode(this, node);
            var tableRootId = this.id + root.id;
            console.log(root.text, ' tableRootId=', tableRootId);
            $.messager.alert('提示', ' 制作中...', 'info');
        }
    });

    $('#treeFinance').tree({
        animate:true,lines:true,
        onClick: function(node){
            var root = getRootNode(this, node);
            var tableRootId = this.id + root.id;
            console.log(root.text, ' tableRootId=', tableRootId);
            $.messager.alert('提示', ' 制作中...', 'info');
        }
    });

    $('#treeDb').tree({
        animate:true,lines:true,
        onClick:function (node) {
            var tableId = this.id + node.id;
            var entrance = {
                51: {fn: danceAddTabFeeItem},
                52: {fn: danceAddTabTeachingMaterial},
                53: {fn: danceAddTabFeeMode},
                54: {fn: danceAddTabClassType},
                55: {fn: danceAddTabDegree},
                56: {fn: danceAddTabJobTitle},
                57: {fn: danceAddTabIntention},
                58: {fn: danceAddTabInfoSrc},
                59: {fn: danceAddTabConsultMode},
                3:  {fn: danceAddTabSchool},
                4:  {fn: danceAddTabUsers}
            };

            if (node.text == '数据库备份') {
                danceOpenTab(node.text, '/static/html/_db_backup.html')
            }else if(node.id == 510){
                danceOpenTab(node.text, '/static/html/_pre_student_details.html')
            }else if(node.id in entrance){
                entrance[node.id].fn(node.text, tableId);
            }else {
                $.messager.alert('提示', ' 制作中...', 'info');
            }
        }
    });

    dcLoadTree();
});

function getRootNode(tree, curNode) {
    var root = curNode;
    var parentNode = $(tree).tree('getParent', root.target);
    while (parentNode) {
        root  = parentNode;
        parentNode = $(tree).tree('getParent', root.target);
    }
    return root;
}

</script>

</body>
<script src="/static/js/dance.student.js"></script>
<script src="/static/js/dance.class.js"></script>
<script src="/static/js/dance.datamgr.js"></script>
<script src="/static/js/dance.editedtable.js"></script>
<script src="/static/js/dance.receipt.js"></script>
<script src="/static/js/dance.teacher.js"></script>
<script src="/static/js/dance.course.js"></script>
</html>