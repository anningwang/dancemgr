<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Window Layout - jQuery EasyUI Demo</title>
	<link rel="stylesheet" type="text/css" href="../lib/jquery-easyui-1.5.2/themes/default/easyui.css">
	<link rel="stylesheet" type="text/css" href="../lib/jquery-easyui-1.5.2/themes/icon.css">
	<script type="text/javascript" src="../lib/jquery-easyui-1.5.2/jquery.min.js"></script>
	<script type="text/javascript" src="../lib/jquery-easyui-1.5.2/jquery.easyui.min.js"></script>
</head>
<body>

<div id="danceWinImport" class="easyui-window" title="导入数据"
					data-options="iconCls:'icon-save', modal:true,minimizable:false,collapsible:false,
					onBeforeClose : function() {
						//console.log('onBeforeClose.');
						$('#danceWinImport').window('destroy');
						$('#danceCommWin').panel('destroy');
					}
					"
					style="width:600px;height:400px;padding:5px;">
	<div class="easyui-layout" data-options="fit:true">
		<form id="danceFormUploadExcel"  method="post" enctype="multipart/form-data">
			<div data-options="region:'north',split:false,border:false" style="height:100px; padding:15px 10px">
				<input class="easyui-filebox" id="uploadExcel" name="uploadExcel" label="请选择要导入的文件：" labelPosition="top"
					   data-options="buttonText:'选择文件',buttonIcon:'icon-search',prompt:'请选择要导入的文件...',accept:'excel/*'"
					   style="width:100%">
			</div>
			<div data-options="region:'center',border:true" style="padding:10px;">
				导入选项：
			</div>
			<div data-options="region:'south',border:false" style="text-align:right;padding:5px 0 0;">
				<a class="easyui-linkbutton" data-options="iconCls:'icon-ok'" href="javascript:void(0)" onclick="danceImportExcel()" style="width:80px">导入</a>
				<a class="easyui-linkbutton" data-options="iconCls:'icon-cancel'" href="javascript:void(0)" onclick="$('#danceWinImport').window('close')" style="width:80px">取消</a>
			</div>
		</form>
	</div>
</div>

<script>
	var danceModuleName = 'danceStudent';
	function danceImportExcel() {
		// 得到上传文件的全路径
		var fileName = $('#uploadExcel').filebox('getValue');
		// console.log(fileName);

		// 进行基本校验
		if (fileName == "") {
			$.messager.alert('提示', '请选择上传文件！', 'info');
		} else {
			// 对文件格式进行校验
			var d1 = /\.[^\.]+$/.exec(fileName);
			if (d1 == ".xls") {
				// 提交表单
				//document.getElementById("danceFormUploadExcel").action="/api/upload";
				//document.getElementById("danceFormUploadExcel").submit();
				//$.messager.alert('提示', '操作成功！', 'info');
				var data = new FormData($('#danceFormUploadExcel')[0]);
				data.append('danceModuleName', danceModuleName);
				$.ajax({
					url: '/api/upload',
					type: 'POST',
					data: data,
					dataType: 'JSON',
					cache: false,
					processData: false,
					contentType: false
				}).done(function(ret){
					if(ret['errorCode'] == 0){
						//var result = '';
						//result += 'name=' + ret['name'] + '<br>';
						///result += 'gender=' + ret['gender'] + '<br>';
						//result += '<img src="' + ret['photo']  + '" width="100">';
						//$('#result').html(result);
						$.messager.alert('提示', ret['msg'] + ' 成功导入 ' + ret['correctNum'] + ' 条数据。', 'info');
					}else{
						$.messager.alert('提示', '文件导入失敗！ ' + ret['msg'], 'info');
					}
				});
			} else {
				$.messager.alert('提示', '请选择xls格式文件！', 'info');
			}
		}
	}
</script>

</body>
</html>